<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity3"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<!--<![endif]-->

<!--<head tag-->
<div th:replace="/include/head :: head"> </div>
<body>
    <section class="container animated fadeInUp">
        <div class="row">
            <div class="col-md-6 col-md-offset-3">
                <div id="login-wrapper">
                    <header>
                        <div class="brand">
                            <a href="index-2.html" class="logo">
                                <i class="fa fa-bar-chart"></i>
                                <span>MOVIE</span>CRACK</a>
                        </div>
                    </header>
                    <div class="panel panel-primary">
                        <div class="panel-heading">
                            <h3 class="panel-title">     
                           Sign In
                        </h3>
                        </div>
                        <div class="panel-body">
                            <p> Login to access your account.</p>
                            <form class="form-horizontal" id="loginForm"  method="POST"  action="/api/users/login" >
                                <div th:if="${param.error}">
                                    <div class="alert alert-danger">Invalid email or
                                        password.</div>
                                </div>
                                <div th:if="${param.logout}">
                                    <div class="alert alert-info">You have been logged out.</div>
                                </div>
                                <div class="form-group">
                                    <div class="col-md-12">

                                        <input type="text" class="form-control" id="username" name="username" th:placeholder="Username" >

                                        <i class="fa fa-user"></i>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="col-md-12">
                                        <input class="form-control"  type="password" th:placeholder="Password" id="password" name="password" >

                                        <i class="fa fa-lock"></i>
                                        <a href="javascript:void(0)" class="help-block">Forgot Your Password?</a>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <div class="col-md-12">
                                        <input type="submit" name="login-submit" id="login-submit" class="btn btn-primary btn-block"  value="Log In"/>
                                        <hr />
                                        <a  th:href="@{/register}" class="btn btn-default btn-block">Not a member? Sign Up</a>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </section>
    <!--Global JS-->

    <!--<FOOTER.HTML-->
    <div th:insert="include/footer :: footer"></div>
</body>
<script type="text/javascript">
$(document).ready(function() {
   //alert("hiiiii");
   $('#loginForm').submit(function (event) {
       // alert("hi");
event.preventDefault();
        var loginRequest = {}
        loginRequest["username"] = $("#username").val();
        loginRequest["password"] = $("#password").val();

        var sjson = JSON.stringify(loginRequest);
        alert(sjson);


        $.ajax({
        type:'post',
       contentType : 'application/json',
       url : "/api/users/login",
       data : JSON.stringify(loginRequest),
       dataType : 'json',
       cache : false,
       timeout : 600000,
       success : function(data) {
       alert(JSON.stringify(data));
       sessionStorage.setItem("token", data.token);
       sessionStorage.setItem("user_id", data.id);
       location.href = "http://localhost:8080/movie/all";

       },
       error: function(jqXHR, exception) {
            if (jqXHR.status === 0) {
                alert('Not connect.\n Verify Network.');
            } else if (jqXHR.status == 404) {
                alert('Requested page not found. [404]');
            } else if (jqXHR.status == 500) {
                alert('Internal Server Error [500].');
            } else if (exception === 'parsererror') {
                alert('Requested JSON parse failed.');
            } else if (exception === 'timeout') {
                alert('Time out error.');
            } else if (exception === 'abort') {
                alert('Ajax request aborted.');
            } else {
                alert('Uncaught Error.\n' + jqXHR.responseText);
                alert('check login, try again');


            }
        }
      });




   });
});

</script>
</html>
